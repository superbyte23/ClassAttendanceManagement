"use strict";function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}var _createClass=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),SimpleTableCellEdition=function SimpleTableCellEdition(n,t){_classCallCheck(this,SimpleTableCellEdition);this.Elem=n;this.oldContent=$(n).html();this.oldValue=t.internals.extractValue(n);this.cellParams=t},SimpleTableCellEditor=function(){function n(t,i){_classCallCheck(this,n);var r=this;typeof t=="undefined"&&(t="table");this.tableId=t;this.params=r._GetExtendedEditorParams(i);this.CellEdition=null;this._TryHandleDataTableReloadEvent();$(document).mouseup(function(n){var t=$("#"+r.tableId);t.is(n.target)||t.has(n.target).length!==0||r._FreeCurrentCell();return})}return _createClass(n,[{key:"SetEditable",value:function(n,t){var i=this,r;if(i._isValidElem(n)){r=i._GetExtendedCellParams(t);$(n).on("click",function(){$(this).hasClass(i.params.inEditClass)||i._EditCell(this,r)});$(n).on("keydown",function(n){$(this).hasClass(i.params.inEditClass)&&i._HandleKeyPressed(n.which,this,r)})}}},{key:"SetEditableClass",value:function(n,t){var i=this,r=i._GetExtendedCellParams(t);$("#"+this.tableId).on("click","td."+n+":not(."+i.params.inEditClass+")",function(){i._EditCell(this,r)});$("#"+this.tableId).on("keydown","td."+n+"."+i.params.inEditClass,function(n){i._HandleKeyPressed(n.which,this,r)})}},{key:"_HandleKeyPressed",value:function(n,t,i){i.keys.validation.includes(n)?this._EndEditCell(t,i):i.keys.cancellation.includes(n)&&this._CancelEditCell(t,i)}},{key:"_EditCell",value:function(n,t){this._FreeCurrentCell();this.CellEdition=new SimpleTableCellEdition(n,t);this.isDataTable&&(this.CellEdition.cellIndex=$("#"+this.tableId).DataTable().cell($(n)).index());var i=t.internals.extractValue(n);$(n).addClass(this.params.inEditClass);t.internals.renderEditor(n,i);this._FireOnEditEnterEvent(n,i)}},{key:"_EndEditCell",value:function(n,t){this._FreeCell(n,t,!0)}},{key:"_CancelEditCell",value:function(n,t){this._FreeCell(n,t,!1)}},{key:"_FreeCell",value:function(n,t,i){var u,r;this._isValidElem(n)&&this.CellEdition!==null&&(u=t.internals.extractEditorValue(n),$(n).removeClass(this.params.inEditClass),$(n).html(""),r=t.formatter(u),t.validation(u)&&this.CellEdition.oldValue!==r||(i=!1),this._FireOnEditExitEvent(n,this.CellEdition.oldValue,r,i),i?(t.internals.renderValue(n,r),this._FireEditedEvent(n,this.CellEdition.oldValue,r)):$(n).html(this.CellEdition.oldContent),this.CellEdition=null)}},{key:"_FreeCurrentCell",value:function(){var n=this._GetCurrentEdition();n!==null&&this._EndEditCell(n.Elem,n.cellParams)}},{key:"_GetCurrentEdition",value:function(){return this.CellEdition===null?null:this.CellEdition}},{key:"_GetExtendedEditorParams",value:function(n){var t=this;return $.extend(!0,{},t._GetDefaultEditorParams(),n)}},{key:"_GetExtendedCellParams",value:function(n){var t=this;return $.extend(!0,{},t._GetDefaultCellParams(),n)}},{key:"_GetDefaultEditorParams",value:function(){return{inEditClass:"inEdit"}}},{key:"_GetDefaultCellParams",value:function(){return{validation:function(){return!0},formatter:function(n){return n},keys:{validation:[13],cancellation:[27]},internals:this._GetDefaultInternals()}}},{key:"_GetDefaultInternals",value:function(){return{renderValue:function(n,t){$(n).text(t)},renderEditor:function(n,t){$(n).html("<input type='text' style=\"width:100%; max-width:none\">");var i=$(n).find("input");i.focus();i.val(t)},extractEditorValue:function(n){return $(n).find("input").val()},extractValue:function(n){return $(n).text()}}}},{key:"_FireOnEditEnterEvent",value:function(n,t){$("#"+this.tableId).trigger({type:"cell:onEditEnter",element:n,oldValue:t})}},{key:"_FireOnEditExitEvent",value:function(n,t,i,r){$("#"+this.tableId).trigger({type:"cell:onEditExit",element:n,newValue:i,oldValue:t,applied:r})}},{key:"_FireEditedEvent",value:function(n,t,i){$("#"+this.tableId).trigger({type:"cell:edited",element:n,newValue:i,oldValue:t})}},{key:"_TryHandleDataTableReloadEvent",value:function(){var n=this;this.isDataTable=!1;try{$.fn.DataTable.isDataTable("#"+n.tableId)&&(n.isDataTable=!0)}catch(t){return}if(n.isDataTable)$("#"+n.tableId).on("draw.dt",function(){if(n.CellEdition!==null&&n.CellEdition.Elem!==null){var t=$("#"+n.tableId).DataTable().cell(n.CellEdition.cellIndex).node();n._EditCell(t,n.CellEdition.cellParams)}})}},{key:"_isValidElem",value:function(n){return n!==null&&typeof n!="undefined"&&$(n).length>0}}]),n}();